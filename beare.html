<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–£—Ç–æ—á–∫–∞-–∫–ª–∏–∫–µ—Ä</title>
  <style>
    :root{
      --bg1:#7dd3fc;
      --bg2:#bae6fd;
      --card:#ffffffcc;
      --text:#0f172a;
      --muted:#475569;
      --shadow: 0 20px 60px rgba(2, 6, 23, .18);
      --radius: 22px;

      --ok:#16a34a;
      --warn:#f59e0b;
      --bad:#ef4444;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      min-height:100vh;
      display:grid;
      place-items:center;
      overflow:hidden;
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
    }

    .cloud{
      position:absolute;
      width:220px;
      height:70px;
      background:#fff;
      border-radius:999px;
      opacity:.85;
      box-shadow: 0 14px 40px rgba(2, 6, 23, .08);
      animation: drift linear infinite;
    }
    .cloud::before, .cloud::after{
      content:"";
      position:absolute;
      background:#fff;
      border-radius:999px;
    }
    .cloud::before{ width:90px; height:90px; left:20px; top:-35px; }
    .cloud::after{ width:120px; height:120px; left:80px; top:-55px; }
    @keyframes drift{
      from{ transform: translateX(-320px); }
      to{ transform: translateX(calc(100vw + 320px)); }
    }

    .waves{
      position:absolute;
      left:0; right:0; bottom:-1px;
      height:35vh;
      pointer-events:none;
      opacity:.9;
    }

    .card{
      position:relative;
      width:min(620px, 94vw);
      padding:18px 16px 16px;
      border-radius: var(--radius);
      background: var(--card);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.55);
      text-align:center;
    }

    h1{
      margin:6px 0 6px;
      font-size: clamp(24px, 3.4vw, 34px);
      letter-spacing: .2px;
    }
    p{
      margin:0 0 10px;
      color: var(--muted);
      font-size: 14px;
    }

    /* tabs */
    .tabs{
      display:flex;
      gap:10px;
      justify-content:center;
      margin: 10px 0 14px;
      flex-wrap:wrap;
    }
    .tab{
      border:none;
      cursor:pointer;
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 800;
      background: rgba(255,255,255,.75);
      color: var(--text);
      border: 1px solid rgba(15, 23, 42, .08);
      box-shadow: 0 10px 24px rgba(2,6,23,.08);
    }
    .tab.active{
      background: rgba(15, 23, 42, .92);
      color:#fff;
      border-color: rgba(15,23,42,.0);
    }

    .panel{ display:none; }
    .panel.active{ display:block; }

    .stats{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin: 10px 0 10px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.75);
      border: 1px solid rgba(15, 23, 42, .08);
      box-shadow: 0 10px 24px rgba(2,6,23,.08);
      font-weight: 800;
    }
    .pill small{ font-weight: 700; color: var(--muted); }

    .duck-wrap{
      position:relative;
      display:grid;
      place-items:center;
      margin: 8px auto 6px;
      width:min(340px, 72vw);
      aspect-ratio: 1 / 1;
    }

    .duck-btn{
      width:100%;
      height:100%;
      border:none;
      background: transparent;
      cursor:pointer;
      padding:0;
      display:grid;
      place-items:center;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .08s ease;
    }
    .duck-btn:active{ transform: scale(.98); }
    .duck-btn:disabled{ cursor:not-allowed; opacity:.65; }

    .duck{
      width: 86%;
      max-width: 320px;
      filter: drop-shadow(0 18px 28px rgba(2,6,23,.22));
      transform-origin: 50% 70%;
    }

    .hint{
      font-size: 13px;
      color: var(--muted);
      margin-top: 6px;
    }

    .pop{ animation: pop .22s ease-out; }
    @keyframes pop{
      0%{ transform: translateY(0) rotate(0deg) scale(1); }
      40%{ transform: translateY(-10px) rotate(-2deg) scale(1.03); }
      100%{ transform: translateY(0) rotate(0deg) scale(1); }
    }

    .bubble{
      position:absolute;
      width:14px; height:14px;
      border-radius:999px;
      background: rgba(255,255,255,.85);
      box-shadow: inset 0 -2px 0 rgba(2,6,23,.06);
      animation: rise .9s ease-out forwards;
      pointer-events:none;
    }
    @keyframes rise{
      from{ transform: translateY(0) scale(.9); opacity: 1; }
      to{ transform: translateY(-90px) scale(1.35); opacity: 0; }
    }

    /* energy bar */
    .energy-box{
      width:min(440px, 88vw);
      margin: 10px auto 0;
      text-align:left;
    }
    .energy-top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      color: var(--muted);
      font-weight: 800;
      font-size: 13px;
      margin-bottom: 6px;
    }
    .bar{
      width:100%;
      height:14px;
      border-radius:999px;
      background: rgba(15, 23, 42, .10);
      overflow:hidden;
      border: 1px solid rgba(15, 23, 42, .08);
    }
    .bar > div{
      height:100%;
      width:0%;
      border-radius:999px;
      transition: width .18s ease;
      background: var(--ok);
    }

    /* inputs */
    .form{
      width:min(520px, 92vw);
      margin: 12px auto 0;
      text-align:left;
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(15, 23, 42, .08);
      border-radius: 18px;
      padding: 12px;
      box-shadow: 0 10px 24px rgba(2,6,23,.08);
    }
    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-bottom: 10px;
    }
    label{
      font-weight: 900;
      font-size: 13px;
      color: var(--muted);
      display:block;
      margin-bottom: 6px;
    }
    input{
      width:100%;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(15,23,42,.12);
      outline:none;
      font-weight: 800;
      background: rgba(255,255,255,.9);
    }
    .col{
      flex: 1 1 180px;
      min-width: 180px;
    }
    .btn{
      border:none;
      cursor:pointer;
      border-radius: 14px;
      padding: 10px 14px;
      font-weight: 900;
      background: rgba(15, 23, 42, .92);
      color:#fff;
      box-shadow: 0 12px 30px rgba(2,6,23,.18);
    }
    .btn.secondary{
      background: rgba(255,255,255,.85);
      color: var(--text);
      border: 1px solid rgba(15, 23, 42, .10);
    }
    .msg{
      margin-top: 8px;
      font-weight: 900;
      color: var(--muted);
      font-size: 13px;
    }
    .msg.good{ color: var(--ok); }
    .msg.bad{ color: var(--bad); }
  </style>
</head>

<body>
  <div class="cloud" style="top:8vh; left:-260px; animation-duration: 42s;"></div>
  <div class="cloud" style="top:16vh; left:-360px; animation-duration: 55s; transform: scale(.9); opacity:.75;"></div>
  <div class="cloud" style="top:26vh; left:-420px; animation-duration: 48s; transform: scale(1.1); opacity:.8;"></div>

  <div class="card">
    <h1>–£—Ç–æ—á–∫–∞-–∫–ª–∏–∫–µ—Ä ü¶Ü</h1>
    <p>–ñ–º–∏ –Ω–∞ —É—Ç–æ—á–∫—É ‚Äî –∫–ª–∏–∫–∏ —Ä–∞—Å—Ç—É—Ç. –≠–Ω–µ—Ä–≥–∏—è —Ç—Ä–∞—Ç–∏—Ç—Å—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.</p>

    <div class="tabs">
      <button class="tab active" id="tabGame">–ò–≥—Ä–∞</button>
      <button class="tab" id="tabRub">–ü–µ—Ä–µ–≤–æ–¥ –≤ —Ä—É–±–ª–∏</button>
    </div>

    <!-- GAME -->
    <div class="panel active" id="panelGame">
      <div class="stats">
        <div class="pill">üí• <span id="count">0</span> <small>–∫–ª–∏–∫–æ–≤</small></div>
        <div class="pill">üèÜ <span id="best">0</span> <small>—Ä–µ–∫–æ—Ä–¥</small></div>
      </div>

      <div class="duck-wrap" id="arena">
        <button class="duck-btn" id="duckBtn" aria-label="–ö–ª–∏–∫ –ø–æ —É—Ç–æ—á–∫–µ">
          <img
            id="duckImg"
            class="duck"
            alt="–£—Ç–æ—á–∫–∞"
            src="https://commons.wikimedia.org/wiki/Special:FilePath/Rubber%20duck.svg"
          />
        </button>
      </div>

      <div class="energy-box">
        <div class="energy-top">
          <div>‚ö° –≠–Ω–µ—Ä–≥–∏—è: <span id="energyText">0</span>/<span id="energyMaxText">0</span></div>
          <div>‚àí<span id="costText">1</span> –∑–∞ –∫–ª–∏–∫ ¬∑ +<span id="regenText">1</span> / <span id="regenSecText">2</span>—Å</div>
        </div>
        <div class="bar"><div id="energyBar"></div></div>
        <div class="hint" id="energyHint">–ï—Å–ª–∏ —ç–Ω–µ—Ä–≥–∏—è –∫–æ–Ω—á–∏—Ç—Å—è ‚Äî –ø–æ–¥–æ–∂–¥–∏, –æ–Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è üôÇ</div>
      </div>

      <div class="form" style="margin-top:12px;">
        <div class="row">
          <div class="col">
            <label for="promo">–ü—Ä–æ–º–æ–∫–æ–¥</label>
            <input id="promo" placeholder='–í–≤–µ–¥–∏ "—Ç–µ—Å—Ç"' autocomplete="off" />
          </div>
          <div style="display:flex; gap:10px; align-items:flex-end;">
            <button class="btn" id="promoBtn">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn secondary" id="resetBtn">–°–±—Ä–æ—Å–∏—Ç—å –∫–ª–∏–∫–∏</button>
          </div>
        </div>
        <div class="msg" id="promoMsg">–ü—Ä–æ–º–æ–∫–æ–¥ <b>—Ç–µ—Å—Ç</b>: –ø–æ–ª–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è, –≤—Å–µ–≥–æ 2 —Ä–∞–∑–∞.</div>
      </div>
    </div>

    <!-- RUB -->
    <div class="panel" id="panelRub">
      <div class="form">
        <div class="row">
          <div class="col">
            <label>–°–∫–æ–ª—å–∫–æ 1 –∫–ª–∏–∫ —Å—Ç–æ–∏—Ç (‚ÇΩ)</label>
            <input id="rate" type="number" min="0" step="0.01" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä 0.5" />
          </div>
          <div class="col">
            <label>–ö–ª–∏–∫–∏ (–±–µ—Ä—ë—Ç—Å—è –∏–∑ –∏–≥—Ä—ã)</label>
            <input id="rubClicks" type="number" min="0" step="1" />
          </div>
        </div>
        <div class="row">
          <button class="btn" id="calcBtn">–ü–æ—Å—á–∏—Ç–∞—Ç—å</button>
          <button class="btn secondary" id="useMyClicksBtn">–í–∑—è—Ç—å –º–æ–∏ –∫–ª–∏–∫–∏</button>
        </div>
        <div class="msg good" id="rubOut">–í–≤–µ–¥–∏ —Ü–µ–Ω—É –∑–∞ –∫–ª–∏–∫ –∏ –Ω–∞–∂–º–∏ ‚Äú–ü–æ—Å—á–∏—Ç–∞—Ç—å‚Äù.</div>
      </div>
      <div class="hint" style="margin-top:10px;">–≠—Ç–æ –ø—Ä–æ—Å—Ç–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤–Ω—É—Ç—Ä–∏ —Ç–≤–æ–µ–≥–æ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.</div>
    </div>
  </div>

  <svg class="waves" viewBox="0 0 1440 320" preserveAspectRatio="none" aria-hidden="true">
    <path fill="rgba(255,255,255,.55)" d="M0,192L80,165.3C160,139,320,85,480,90.7C640,96,800,160,960,181.3C1120,203,1280,181,1360,170.7L1440,160L1440,320L1360,320C1280,320,1120,320,960,320C800,320,640,320,480,320C320,320,160,320,80,320L0,320Z"></path>
    <path fill="rgba(255,255,255,.35)" d="M0,256L96,234.7C192,213,384,171,576,170.7C768,171,960,213,1152,218.7C1344,224,1536,192,1632,176L1728,160L1728,320L1632,320C1536,320,1344,320,1152,320C960,320,768,320,576,320C384,320,192,320,96,320L0,320Z"></path>
  </svg>

  <script>
    // ---------- STORAGE KEYS ----------
    const K_COUNT = 'duck_count';
    const K_BEST  = 'duck_best';
    const K_EN    = 'duck_energy';
    const K_PROMO_USES = 'duck_promo_test_uses'; // 0..2
    const K_RATE  = 'duck_rub_rate';

    // ---------- GAME CONFIG ----------
    const ENERGY_MAX = 100;
    const CLICK_COST = 1;
    const REGEN_AMOUNT = 1;
    const REGEN_EVERY_MS = 2000; // 2 seconds

    // ---------- ELEMENTS ----------
    const countEl = document.getElementById('count');
    const bestEl  = document.getElementById('best');
    const duckBtn = document.getElementById('duckBtn');
    const duckImg = document.getElementById('duckImg');
    const arena   = document.getElementById('arena');

    const energyText = document.getElementById('energyText');
    const energyMaxText = document.getElementById('energyMaxText');
    const costText = document.getElementById('costText');
    const regenText = document.getElementById('regenText');
    const regenSecText = document.getElementById('regenSecText');
    const energyBar = document.getElementById('energyBar');
    const energyHint = document.getElementById('energyHint');

    const promoInp = document.getElementById('promo');
    const promoBtn = document.getElementById('promoBtn');
    const promoMsg = document.getElementById('promoMsg');
    const resetBtn = document.getElementById('resetBtn');

    // tabs
    const tabGame = document.getElementById('tabGame');
    const tabRub  = document.getElementById('tabRub');
    const panelGame = document.getElementById('panelGame');
    const panelRub  = document.getElementById('panelRub');

    // rub panel
    const rateInp = document.getElementById('rate');
    const rubClicksInp = document.getElementById('rubClicks');
    const calcBtn = document.getElementById('calcBtn');
    const useMyClicksBtn = document.getElementById('useMyClicksBtn');
    const rubOut = document.getElementById('rubOut');

    // ---------- STATE ----------
    let count = Number(localStorage.getItem(K_COUNT) || 0);
    let best  = Number(localStorage.getItem(K_BEST)  || 0);

    let energy = Number(localStorage.getItem(K_EN));
    if (!Number.isFinite(energy)) energy = ENERGY_MAX;

    let promoUses = Number(localStorage.getItem(K_PROMO_USES) || 0); // used count
    if (!Number.isFinite(promoUses)) promoUses = 0;

    // ---------- UI HELPERS ----------
    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    function setEnergyBar(){
      const pct = (energy / ENERGY_MAX) * 100;
      energyBar.style.width = pct + '%';

      // color by percent
      if (pct > 55) energyBar.style.background = 'var(--ok)';
      else if (pct > 20) energyBar.style.background = 'var(--warn)';
      else energyBar.style.background = 'var(--bad)';

      duckBtn.disabled = energy < CLICK_COST;
      energyHint.textContent = (energy < CLICK_COST)
        ? '–≠–Ω–µ—Ä–≥–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å üò¥ –ü–æ–¥–æ–∂–¥–∏ ‚Äî –æ–Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è.'
        : '–ñ–º–∏ –Ω–∞ —É—Ç–æ—á–∫—É üôÇ';
    }

    function render(){
      countEl.textContent = count;
      bestEl.textContent  = best;

      energyText.textContent = energy;
      energyMaxText.textContent = ENERGY_MAX;

      costText.textContent = CLICK_COST;
      regenText.textContent = REGEN_AMOUNT;
      regenSecText.textContent = Math.round(REGEN_EVERY_MS/1000);

      setEnergyBar();

      // promo text
      const left = Math.max(0, 2 - promoUses);
      promoMsg.innerHTML = `–ü—Ä–æ–º–æ–∫–æ–¥ <b>—Ç–µ—Å—Ç</b>: –ø–æ–ª–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è, –æ—Å—Ç–∞–ª–æ—Å—å –∞–∫—Ç–∏–≤–∞—Ü–∏–π: <b>${left}</b>/2`;
    }

    function save(){
      localStorage.setItem(K_COUNT, String(count));
      localStorage.setItem(K_BEST,  String(best));
      localStorage.setItem(K_EN,    String(energy));
      localStorage.setItem(K_PROMO_USES, String(promoUses));
    }

    // ---------- EFFECTS ----------
    function bubble(clientX, clientY){
      const b = document.createElement('div');
      b.className = 'bubble';
      const rect = arena.getBoundingClientRect();
      b.style.left = (clientX - rect.left) + 'px';
      b.style.top  = (clientY - rect.top) + 'px';
      const size = 10 + Math.random()*16;
      b.style.width = b.style.height = size + 'px';
      arena.appendChild(b);
      setTimeout(()=> b.remove(), 900);
    }

    function popDuck(){
      duckImg.classList.remove('pop');
      void duckImg.offsetWidth; // restart animation
      duckImg.classList.add('pop');
    }

    // ---------- GAME LOGIC ----------
    function clickDuck(e){
      if (energy < CLICK_COST) return;

      energy = clamp(energy - CLICK_COST, 0, ENERGY_MAX);
      count += 1;
      if (count > best) best = count;

      save();
      render();
      popDuck();
      bubble(e.clientX, e.clientY);
    }

    duckBtn.addEventListener('click', clickDuck, {passive:true});

    // regen loop
    setInterval(() => {
      if (energy < ENERGY_MAX) {
        energy = clamp(energy + REGEN_AMOUNT, 0, ENERGY_MAX);
        save();
        render();
      }
    }, REGEN_EVERY_MS);

    resetBtn.addEventListener('click', ()=>{
      count = 0;
      save();
      render();
    });

    // ---------- PROMO ----------
    function setPromoMessage(text, ok){
      promoMsg.className = 'msg ' + (ok ? 'good' : 'bad');
      promoMsg.innerHTML = text;
      setTimeout(()=> { promoMsg.className='msg'; render(); }, 2500);
    }

    promoBtn.addEventListener('click', ()=>{
      const code = (promoInp.value || '').trim().toLowerCase();

      if (code !== '—Ç–µ—Å—Ç') {
        setPromoMessage('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥. –ü–æ–ø—Ä–æ–±—É–π <b>—Ç–µ—Å—Ç</b>.', false);
        return;
      }
      if (promoUses >= 2) {
        setPromoMessage('‚õî –ü—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω 2 —Ä–∞–∑–∞.', false);
        return;
      }

      promoUses += 1;
      energy = ENERGY_MAX;
      promoInp.value = '';
      save();
      render();
      setPromoMessage('‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω: —ç–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ 100%.', true);
    });

    // ---------- TABS ----------
    function setTab(which){
      const isGame = which === 'game';
      tabGame.classList.toggle('active', isGame);
      tabRub.classList.toggle('active', !isGame);
      panelGame.classList.toggle('active', isGame);
      panelRub.classList.toggle('active', !isGame);
    }
    tabGame.addEventListener('click', ()=> setTab('game'));
    tabRub.addEventListener('click', ()=> {
      rubClicksInp.value = String(count);
      setTab('rub');
    });

    // ---------- RUB CONVERTER ----------
    const savedRate = localStorage.getItem(K_RATE);
    if (savedRate !== null) rateInp.value = savedRate;

    useMyClicksBtn.addEventListener('click', ()=>{
      rubClicksInp.value = String(count);
    });

    calcBtn.addEventListener('click', ()=>{
      const rate = Number(rateInp.value);
      const clicks = Number(rubClicksInp.value);

      if (!Number.isFinite(rate) || rate < 0) {
        rubOut.className = 'msg bad';
        rubOut.textContent = '–í–≤–µ–¥–∏ –Ω–æ—Ä–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –∑–∞ –∫–ª–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä 0.5).';
        return;
      }
      if (!Number.isFinite(clicks) || clicks < 0) {
        rubOut.className = 'msg bad';
        rubOut.textContent = '–ö–ª–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–æ–º.';
        return;
      }

      localStorage.setItem(K_RATE, String(rate));
      const rub = clicks * rate;
      rubOut.className = 'msg good';
      rubOut.textContent = `–ò—Ç–æ–≥–æ: ${rub.toFixed(2)} ‚ÇΩ`;
    });

    // init
    energy = clamp(energy, 0, ENERGY_MAX);
    render();
  </script>
</body>
</html>
