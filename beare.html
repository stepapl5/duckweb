<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Duck Clicker</title>
  <style>
    :root{
      --bg1:#7dd3fc; --bg2:#bae6fd;
      --card:#ffffffcc; --text:#0f172a; --muted:#475569;
      --shadow: 0 20px 60px rgba(2, 6, 23, .18);
      --radius: 22px; --ok:#16a34a; --bad:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      min-height:100svh;
      display:grid;
      place-items:center;
      overflow:hidden;
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
      padding:
        max(env(safe-area-inset-top), 10px)
        max(env(safe-area-inset-right), 10px)
        max(env(safe-area-inset-bottom), 10px)
        max(env(safe-area-inset-left), 10px);
    }

    .cloud{ position:absolute; width:220px; height:70px; background:#fff; border-radius:999px; opacity:.85;
      box-shadow: 0 14px 40px rgba(2, 6, 23, .08); animation: drift linear infinite; }
    .cloud::before,.cloud::after{ content:""; position:absolute; background:#fff; border-radius:999px; }
    .cloud::before{ width:90px; height:90px; left:20px; top:-35px; }
    .cloud::after{ width:120px; height:120px; left:80px; top:-55px; }
    @keyframes drift{ from{ transform: translateX(-320px);} to{ transform: translateX(calc(100vw + 320px)); } }

    .card{
      position:relative;
      width:min(560px, 96vw);
      padding:14px;
      border-radius: var(--radius);
      background: var(--card);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.55);
      text-align:center;
    }
    h1{ margin:6px 0 4px; font-size: clamp(20px, 3.2vw, 28px); }
    .sub{ margin:0 0 10px; color: var(--muted); font-size: 13px; }

    .topbar{
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      margin: 8px 0 10px;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px; border-radius:999px;
      background: rgba(255,255,255,.75);
      border: 1px solid rgba(15, 23, 42, .08);
      box-shadow: 0 10px 24px rgba(2,6,23,.08);
      font-weight: 900;
    }
    .pill small{ font-weight:900; color: var(--muted); }

    .duck-wrap{
      position:relative;
      display:grid;
      place-items:center;
      margin: 6px auto 6px;
      width:min(320px, 74vw);
      aspect-ratio: 1 / 1;
    }
    .duck-btn{
      width:100%; height:100%;
      border:none; background:transparent;
      cursor:pointer; padding:0;
      display:grid; place-items:center;
      user-select:none; -webkit-tap-highlight-color: transparent;
      transition: transform .08s ease;
    }
    .duck-btn:active{ transform: scale(.98); }
    .duck{
      width: 86%;
      max-width: 300px;
      filter: drop-shadow(0 18px 28px rgba(2,6,23,.22));
      transform-origin: 50% 70%;
    }
    .pop{ animation: pop .22s ease-out; }
    @keyframes pop{
      0%{ transform: translateY(0) rotate(0deg) scale(1); }
      40%{ transform: translateY(-10px) rotate(-2deg) scale(1.03); }
      100%{ transform: translateY(0) rotate(0deg) scale(1); }
    }
    .bubble{
      position:absolute; width:14px; height:14px; border-radius:999px;
      background: rgba(255,255,255,.85);
      box-shadow: inset 0 -2px 0 rgba(2,6,23,.06);
      animation: rise .9s ease-out forwards;
      pointer-events:none;
    }
    @keyframes rise{
      from{ transform: translateY(0) scale(.9); opacity: 1; }
      to{ transform: translateY(-90px) scale(1.35); opacity: 0; }
    }
    .hint{ margin-top:8px; font-size: 12px; color: var(--muted); }

    /* floating buttons */
    .float{
      position:fixed;
      right: max(env(safe-area-inset-right), 12px);
      top: 50%;
      transform: translateY(-50%);
      z-index: 50;
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:flex-end;
    }
    .fab{
      width:56px; height:56px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      background: rgba(15, 23, 42, .92);
      color:#fff;
      font-weight: 1000;
      box-shadow: 0 16px 40px rgba(2,6,23,.22);
    }
    .fab span{ display:block; font-size:10px; letter-spacing:.4px; margin-top:2px; opacity:.9; }

    /* modal */
    .modal-back{
      position:fixed; inset:0; z-index:100;
      background: rgba(2,6,23,.45);
      display:none;
      align-items:center; justify-content:center;
      padding: max(env(safe-area-inset-top), 10px) 10px max(env(safe-area-inset-bottom), 10px);
    }
    .modal-back.show{ display:flex; }
    .modal{
      width:min(620px, 96vw);
      background: rgba(255,255,255,.94);
      border: 1px solid rgba(15,23,42,.10);
      border-radius: 22px;
      box-shadow: 0 22px 70px rgba(2,6,23,.28);
      padding: 12px;
      text-align:center;
      max-height: 92svh;
      overflow:auto;
    }
    .modal h2{ margin:6px 0 6px; font-size: 18px; }
    .row{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:flex-end; justify-content:center;
      margin-top: 10px;
    }
    label{
      display:block; font-weight: 1000; color: var(--muted);
      font-size: 12px; margin-bottom:6px; text-align:left;
    }
    input{
      width: 220px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(15,23,42,.12);
      outline:none;
      font-weight: 1000;
      background: rgba(255,255,255,.95);
    }
    .btn{
      border:none; cursor:pointer; border-radius: 14px;
      padding: 10px 14px; font-weight: 1000;
      background: rgba(15, 23, 42, .92); color:#fff;
      box-shadow: 0 12px 30px rgba(2,6,23,.18);
    }
    .btn.secondary{
      background: rgba(255,255,255,.90); color: var(--text);
      border: 1px solid rgba(15, 23, 42, .10);
    }
    .msg{ margin-top:10px; font-weight: 1000; font-size: 13px; color: var(--muted); }
    .msg.good{ color: var(--ok); }
    .msg.bad{ color: var(--bad); }

    /* flappy canvas */
    canvas{
      width: min(420px, 92vw);
      height: auto;
      border-radius: 18px;
      background: rgba(255,255,255,.70);
      border: 1px solid rgba(15, 23, 42, .10);
      box-shadow: 0 12px 30px rgba(2,6,23,.12);
      touch-action: manipulation;
      outline:none;
      margin-top: 10px;
    }
    .flhud{
      display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
      width:min(420px, 92vw); margin: 8px auto 0;
      color: var(--muted); font-weight:1000; font-size: 13px;
    }
  </style>
</head>

<body>
  <div class="cloud" style="top:8vh; left:-260px; animation-duration: 42s;"></div>
  <div class="cloud" style="top:16vh; left:-360px; animation-duration: 55s; transform: scale(.9); opacity:.75;"></div>
  <div class="cloud" style="top:26vh; left:-420px; animation-duration: 48s; transform: scale(1.1); opacity:.8;"></div>

  <div class="card">
    <h1>–ö–ª–∏–∫–µ—Ä —É—Ç–æ—á–∫–∏ ü¶Ü</h1>
    <div class="sub">–ö–ª–∏–∫–∞–π –ø–æ —É—Ç–∫–µ ‚Üí –æ—á–∫–∏. –°–ø—Ä–∞–≤–∞: ‚ÇΩ (–ø–µ—Ä–µ–≤–æ–¥) –∏ Flappy (—Å—Ç–∞–≤–∫–∞).</div>

    <div class="topbar">
      <div class="pill">‚≠ê <span id="balance">0</span> <small>–æ—á–∫–∏</small></div>
      <div class="pill">üí• <span id="taps">0</span> <small>–∫–ª–∏–∫–∏</small></div>
    </div>

    <div class="duck-wrap" id="arena">
      <button class="duck-btn" id="duckBtn" aria-label="–ö–ª–∏–∫ –ø–æ —É—Ç–æ—á–∫–µ">
        <img id="duckImg" class="duck" alt="–£—Ç–æ—á–∫–∞"
             src="https://commons.wikimedia.org/wiki/Special:FilePath/Rubber%20duck.svg"/>
      </button>
    </div>

    <div class="hint">–ü–µ—Ä–µ–≤–æ–¥: 1 –æ—á–∫–æ = 0.01 ‚ÇΩ. –í Flappy –Ω—É–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ 40.</div>
  </div>

  <!-- FLOAT BUTTONS -->
  <div class="float">
    <button class="fab" id="openRub" type="button">‚ÇΩ<span>–†—É–±–ª–∏</span></button>
    <button class="fab" id="openFlappy" type="button">üéÆ<span>Flappy</span></button>
  </div>

  <!-- RUB MODAL (–ü–ï–†–ï–í–û–î –í –†–£–ë–õ–ò) -->
  <div class="modal-back" id="rubBack">
    <div class="modal">
      <h2>–ü–µ—Ä–µ–≤–æ–¥ –≤ —Ä—É–±–ª–∏</h2>
      <div class="msg">–ö—É—Ä—Å: <b>1 –æ—á–∫–æ = 0.01 ‚ÇΩ</b></div>

      <div class="row">
        <div>
          <label>–¢–≤–æ–∏ –æ—á–∫–∏</label>
          <input id="rubPoints" type="text" readonly/>
        </div>
        <div>
          <label>–°—É–º–º–∞ ‚ÇΩ</label>
          <input id="rubSum" type="text" readonly/>
        </div>
      </div>

      <div class="row">
        <button class="btn" id="calcRub" type="button">–ü–æ—Å—á–∏—Ç–∞—Ç—å</button>
        <button class="btn secondary" id="closeRub" type="button">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- FLAPPY MODAL -->
  <div class="modal-back" id="flBack">
    <div class="modal">
      <h2>Flappy Duck ‚Äî —Å—Ç–∞–≤–∫–∞</h2>
      <div class="msg">–°—Ç–∞–≤–∫–∞ –æ—á–∫–∞–º–∏. –ü—Ä–æ–π–¥–∏ <b>40</b> ‚Üí –ø–æ–ª—É—á–∏—à—å <b>x2</b>. –ü—Ä–æ–∏–≥—Ä–∞–ª ‚Üí —Å—Ç–∞–≤–∫–∞ —Å–≥–æ—Ä–∞–µ—Ç.</div>

      <div class="row">
        <div>
          <label>–°—Ç–∞–≤–∫–∞ (–æ—á–∫–∏)</label>
          <input id="stakeInp" type="number" min="1" step="1" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä 50"/>
        </div>
        <button class="btn" id="startFlappy" type="button">–ò–≥—Ä–∞—Ç—å</button>
        <button class="btn secondary" id="closeFlappy" type="button">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>

      <canvas id="cv" width="360" height="512"></canvas>

      <div class="flhud">
        <div>–°—á—ë—Ç: <span id="score">0</span>/40</div>
        <div>–°—Ç–∞–≤–∫–∞: <span id="stakeNow">0</span></div>
        <div>–°—Ç–∞—Ç—É—Å: <span id="status">–Ω–µ –∏–≥—Ä–∞–µ–º</span></div>
      </div>

      <div class="row" style="margin-top:10px;">
        <button class="btn secondary" id="restartBtn" type="button">–†–µ—Å—Ç–∞—Ä—Ç</button>
      </div>

      <div class="msg" id="flMsg"></div>
    </div>
  </div>

<script>
  // ---------- CLICKER ----------
  const K_BAL = 'duck_balance';
  const K_TAPS = 'duck_taps';
  const RUB_PER_POINT = 0.01;

  let balance = Number(localStorage.getItem(K_BAL) || 0);
  let taps = Number(localStorage.getItem(K_TAPS) || 0);

  const balanceEl = document.getElementById('balance');
  const tapsEl = document.getElementById('taps');
  const duckBtn = document.getElementById('duckBtn');
  const duckImg = document.getElementById('duckImg');
  const arena = document.getElementById('arena');

  function saveTap(){
    localStorage.setItem(K_BAL, String(balance));
    localStorage.setItem(K_TAPS, String(taps));
  }
  function renderTap(){
    balanceEl.textContent = balance;
    tapsEl.textContent = taps;
  }
  function popDuck(){
    duckImg.classList.remove('pop');
    void duckImg.offsetWidth;
    duckImg.classList.add('pop');
  }
  function bubble(clientX, clientY){
    const b = document.createElement('div');
    b.className = 'bubble';
    const rect = arena.getBoundingClientRect();
    b.style.left = (clientX - rect.left) + 'px';
    b.style.top  = (clientY - rect.top) + 'px';
    const size = 10 + Math.random()*16;
    b.style.width = b.style.height = size + 'px';
    arena.appendChild(b);
    setTimeout(()=> b.remove(), 900);
  }

  duckBtn.addEventListener('click', (e)=>{
    taps += 1;
    balance += 1;
    saveTap();
    renderTap();
    popDuck();
    bubble(e.clientX, e.clientY);
  }, {passive:true});

  renderTap();

  // ---------- RUB MODAL (–ü–ï–†–ï–í–û–î) ----------
  const rubBack = document.getElementById('rubBack');
  const openRub = document.getElementById('openRub');
  const closeRub = document.getElementById('closeRub');
  const calcRub = document.getElementById('calcRub');
  const rubPoints = document.getElementById('rubPoints');
  const rubSum = document.getElementById('rubSum');

  function updateRub(){
    rubPoints.value = String(balance);
    rubSum.value = (balance * RUB_PER_POINT).toFixed(2) + ' ‚ÇΩ';
  }
  openRub.addEventListener('click', ()=>{ updateRub(); rubBack.classList.add('show'); });
  closeRub.addEventListener('click', ()=> rubBack.classList.remove('show'));
  rubBack.addEventListener('click', (e)=>{ if (e.target === rubBack) rubBack.classList.remove('show'); });
  calcRub.addEventListener('click', updateRub);

  // ---------- FLAPPY MODAL ----------
  const flBack = document.getElementById('flBack');
  const openFlappy = document.getElementById('openFlappy');
  const closeFlappy = document.getElementById('closeFlappy');
  const startFlappyBtn = document.getElementById('startFlappy');
  const stakeInp = document.getElementById('stakeInp');
  const stakeNowEl = document.getElementById('stakeNow');
  const scoreEl = document.getElementById('score');
  const statusEl = document.getElementById('status');
  const flMsg = document.getElementById('flMsg');
  const restartBtn = document.getElementById('restartBtn');

  openFlappy.addEventListener('click', ()=>{ flBack.classList.add('show'); syncUI(); draw(); });
  closeFlappy.addEventListener('click', ()=> flBack.classList.remove('show'));
  flBack.addEventListener('click', (e)=>{ if (e.target === flBack) flBack.classList.remove('show'); });

  // ---------- FLAPPY (–ß–£–¢–¨ –õ–ï–ì–ß–ï) ----------
  const cv = document.getElementById('cv');
  const ctx = cv.getContext('2d');
  const W = cv.width, H = cv.height;

  const TARGET = 40;

  // –ë–´–õ–û —Å–ª–æ–∂–Ω–µ–µ ‚Äî –°–¢–ê–õ–û –ß–£–¢–¨ –ª–µ–≥—á–µ:
  const GRAV = 0.44;     // –±—ã–ª–æ 0.45
  const FLAP = -7.55;    // –±—ã–ª–æ -7.3
  const SPEED = 2.50;    // –±—ã–ª–æ 2.6
  const GAP = 165;       // –±—ã–ª–æ 150
  const PIPE_W = 64;
  const SPAWN_EVERY = 100; // –±—ã–ª–æ 95

  let state = 'idle'; // idle, play, over, win
  let stake = 0;
  let score = 0;

  const duck = { x: 90, y: H/2, vy: 0, r: 16 };
  const pipes = [];
  let spawnTimer = 0;

  function setMsg(text, kind){
    flMsg.className = 'msg ' + (kind || '');
    flMsg.innerHTML = text || '';
  }
  function syncUI(){
    stakeNowEl.textContent = stake;
    scoreEl.textContent = score;
    statusEl.textContent =
      state==='idle' ? '–Ω–µ –∏–≥—Ä–∞–µ–º' :
      state==='play' ? '–∏–≥—Ä–∞' :
      state==='win' ? '–ø–æ–±–µ–¥–∞' : '–ø—Ä–æ–∏–≥—Ä–∞–ª';
    renderTap();
  }
  function resetRound(toIdle=true){
    score = 0;
    duck.x = 90; duck.y = H/2; duck.vy = 0;
    pipes.length = 0;
    spawnTimer = 0;
    state = toIdle ? 'idle' : 'play';
    setMsg('', '');
    syncUI();
  }
  function addPipe(){
    const minTop = 70;
    const maxTop = H - 140 - GAP;
    const topH = Math.floor(minTop + Math.random()*(maxTop - minTop));
    pipes.push({ x: W + 20, topH, passed: false });
  }
  function flap(){
    if (state !== 'play') return;
    duck.vy = FLAP;
  }
  function hitPipe(p){
    const dx1 = duck.x - duck.r, dx2 = duck.x + duck.r;
    const dy1 = duck.y - duck.r, dy2 = duck.y + duck.r;
    const px1 = p.x, px2 = p.x + PIPE_W;
    const topY2 = p.topH;
    const botY1 = p.topH + GAP;

    const xOverlap = !(dx2 < px1 || dx1 > px2);
    if (!xOverlap) return false;
    return (dy1 < topY2) || (dy2 > botY1);
  }
  function win(){
    if (state !== 'play') return;
    state = 'win';
    balance += (stake * 2);
    saveTap();
    setMsg(`‚úÖ –ü–æ–±–µ–¥–∞! –í—ã–∏–≥—Ä—ã—à: <b>${stake} √ó 2</b>.`, 'good');
    syncUI();
  }
  function gameOver(){
    if (state !== 'play') return;
    state = 'over';
    setMsg(`‚ùå –ü—Ä–æ–∏–≥—Ä–∞–ª. –°—Ç–∞–≤–∫–∞ <b>${stake}</b> —Å–≥–æ—Ä–µ–ª–∞.`, 'bad');
    syncUI();
  }
  function update(){
    duck.vy += GRAV;
    duck.y += duck.vy;

    if (duck.y > H - 30){ duck.y = H - 30; gameOver(); }
    if (duck.y < 10){ duck.y = 10; duck.vy = 0; }

    spawnTimer += 1;
    if (spawnTimer > SPAWN_EVERY){
      spawnTimer = 0;
      addPipe();
    }

    for (const p of pipes){
      p.x -= SPEED;

      if (!p.passed && p.x + PIPE_W < duck.x){
        p.passed = true;
        score += 1;
        if (score >= TARGET) win();
      }
      if (hitPipe(p)) gameOver();
    }

    while (pipes.length && pipes[0].x + PIPE_W < -20) pipes.shift();
  }

  function roundRect(x,y,w,h,r,fill,stroke){
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r);
    ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r);
    ctx.arcTo(x,y,x+w,y,r);
    ctx.closePath();
    if (fill) ctx.fill();
    if (stroke) ctx.stroke();
  }

  function drawDuck(x,y,rot){
    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(rot);

    ctx.beginPath(); ctx.ellipse(0,0,18,14,0,0,Math.PI*2);
    ctx.fillStyle = '#fbbf24'; ctx.fill();

    ctx.beginPath(); ctx.ellipse(-2,3,10,8,0,0,Math.PI*2);
    ctx.fillStyle = '#fde68a'; ctx.fill();

    ctx.beginPath(); ctx.ellipse(14,-8,10,9,0,0,Math.PI*2);
    ctx.fillStyle = '#fbbf24'; ctx.fill();

    ctx.beginPath(); ctx.ellipse(26,-6,8,4,0,0,Math.PI*2);
    ctx.fillStyle = '#fb923c'; ctx.fill();

    ctx.beginPath(); ctx.arc(16,-10,2.2,0,Math.PI*2);
    ctx.fillStyle = '#0f172a'; ctx.fill();

    ctx.restore();
  }

  function drawBackground(){
    ctx.clearRect(0,0,W,H);
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0,'#93c5fd');
    g.addColorStop(1,'#bae6fd');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);

    ctx.fillStyle = 'rgba(255,255,255,.55)';
    ctx.beginPath();
    ctx.moveTo(0,H-90);
    ctx.quadraticCurveTo(W*0.25,H-140,W*0.5,H-105);
    ctx.quadraticCurveTo(W*0.75,H-70,W,H-115);
    ctx.lineTo(W,H); ctx.lineTo(0,H);
    ctx.closePath(); ctx.fill();

    ctx.fillStyle = 'rgba(15,23,42,.08)';
    ctx.fillRect(0,H-28,W,28);
  }

  function drawPipes(){
    for (const p of pipes){
      ctx.fillStyle = 'rgba(15,23,42,.18)';
      ctx.strokeStyle = 'rgba(15,23,42,.20)';
      ctx.lineWidth = 2;

      ctx.fillRect(p.x, 0, PIPE_W, p.topH);
      ctx.strokeRect(p.x, 0, PIPE_W, p.topH);

      const by = p.topH + GAP;
      ctx.fillRect(p.x, by, PIPE_W, H - by - 28);
      ctx.strokeRect(p.x, by, PIPE_W, H - by - 28);
    }
  }

  function drawOverlay(text){
    ctx.fillStyle = 'rgba(255,255,255,.80)';
    ctx.strokeStyle = 'rgba(15,23,42,.10)';
    ctx.lineWidth = 2;
    const bw = 310, bh = 90;
    const bx = (W-bw)/2, by = 82;
    roundRect(bx,by,bw,bh,18,true,true);

    ctx.fillStyle = '#0f172a';
    ctx.font = '1000 16px system-ui';
    ctx.textAlign = 'center';
    ctx.fillText(text, W/2, by+40);

    ctx.fillStyle = '#475569';
    ctx.font = '900 13px system-ui';
    ctx.fillText('–¢–∞–ø/–∫–ª–∏–∫/–ø—Ä–æ–±–µ–ª ‚Äî –ø—Ä—ã–∂–æ–∫', W/2, by+64);
  }

  function draw(){
    drawBackground();
    drawPipes();
    const rot = Math.max(-0.6, Math.min(0.8, duck.vy * 0.06));
    drawDuck(duck.x, duck.y, rot);

    ctx.fillStyle = 'rgba(15,23,42,.75)';
    ctx.font = '1000 22px system-ui';
    ctx.textAlign = 'left';
    ctx.fillText(String(score), 14, 34);

    if (state === 'idle') drawOverlay('–í–≤–µ–¥–∏ —Å—Ç–∞–≤–∫—É –∏ –Ω–∞–∂–º–∏ ‚Äú–ò–≥—Ä–∞—Ç—å‚Äù');
    if (state === 'over') drawOverlay('–ü—Ä–æ–∏–≥—Ä–∞–ª. –ù–∞–∂–º–∏ ‚Äú–†–µ—Å—Ç–∞—Ä—Ç‚Äù');
    if (state === 'win') drawOverlay('–ü–æ–±–µ–¥–∞! –ù–∞–∂–º–∏ ‚Äú–†–µ—Å—Ç–∞—Ä—Ç‚Äù');
  }

  function loop(){
    if (state === 'play') update();
    draw();
    requestAnimationFrame(loop);
  }

  cv.addEventListener('pointerdown', (e)=>{ e.preventDefault(); flap(); }, {passive:false});
  window.addEventListener('keydown', (e)=>{
    if (e.code === 'Space'){ e.preventDefault(); flap(); }
  }, {passive:false});

  startFlappyBtn.addEventListener('click', ()=>{
    const s = Math.floor(Number(stakeInp.value));
    if (!Number.isFinite(s) || s <= 0){ setMsg('–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É (>0).', 'bad'); return; }
    if (balance < s){ setMsg('–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –æ—á–∫–æ–≤ –Ω–∞ —Å—Ç–∞–≤–∫—É.', 'bad'); return; }

    balance -= s; saveTap(); renderTap();
    stake = s;
    resetRound(false);
    duck.vy = FLAP;
    setMsg('–£–¥–∞—á–∏! –¶–µ–ª—å ‚Äî 40.', '');
    syncUI();
  });

  restartBtn.addEventListener('click', ()=> resetRound(true));

  resetRound(true);
  requestAnimationFrame(loop);
</script>
</body>
</html>

